function CoreCkeditorController(){var e=this;e.name="CoreCkeditorController"}function contentEditable(){return{require:"ngModel",link:function(e,t,o,n){t.bind("blur",function(){e.$apply(function(){n.$setViewValue(t.html())})}),n.render=function(e){t.html(e)},n.$setViewValue(t.html()),t.bind("keydown",function(e){console.log("keydown "+e.which);var o=27==e.which,r=e.target;o&&(console.log("esc"),n.$setViewValue(t.html()),r.blur(),e.preventDefault())})}}}function coreCkeditor(e,t){function o(o,n,r,i){function l(){o.editActive=!0,a=CKEDITOR.replace(o.editorName,u),a.on("change",function(){o.showData(),e(function(){o.$apply()},1)})}var a,c="ltr",d="en";angular.isDefined(r.language)&&"hebrew"==r.language&&(c="rtl",d="he"),o.editorName="ckeditor"+Math.random(),o.init=function(){l()},(angular.isDefined(r.initEdit)||""==i.ngModel)&&e(function(){l()},1);var u={title:i.fieldTitle,contentsLangDirection:c,contentsLanguage:d,uiColor:"#6099B6",removeButtons:"Flash,Language"};console.log("ckedit - cs.config.isAdmin",cs.config.isAdmin),t.isAdmin?u.toolbarGroups=[{name:"basicstyles",groups:["basicstyles"]},{name:"links",groups:["links"]},{name:"paragraph",groups:["list","blocks","align","bidi"]},{name:"document",groups:["mode"]},{name:"insert",groups:["insert"]},{name:"styles",groups:["styles"]},{name:"about",groups:["about"]}]:(u.toolbar=[{name:"basicstyles",items:["Bold","Italic"]},{name:"links",items:["Link","Unlink"]},{name:"paragraph",items:["NumberedList","BulletedList"]},{name:"styles",items:["Format"]}],u.format_tags="h2;h3;h4"),o.showData=function(){var e=a.getData();i.ngModel=e}}var n={link:o,templateUrl:"views/angularCoreRest/coreCkeditor.ng.html",restrict:"A",scope:{ngModel:"=",fieldTitle:"@"},controller:"CoreCkeditorController",controllerAs:"vm",bindToController:!0};return n}function coreKeepRatio(e){function t(t,o,n){function r(){l(),d=!0}function i(){var e=a.width()*c;return e}function l(){var e=i();a.height(e)}var a=o,c=t.widthToHeightRatio||1;t.relativeElementSelector&&(a=$(t.relativeElementSelector));var d=!1;e(function(){r(),$(window).resize(function(){l()})},1),e(l,2e3)}var o={link:t,restrict:"A",scope:{widthToHeightRatio:"=",relativeElementSelector:"="}};return o}function coreAddAutocompleteDirectiveFactory(e){var t=function(t,o){function n(t,n,r,i){t.itemTitle=o.itemTitle?o.itemTitle:"item",t.multipleSelect=o.multipleSelect,t.addItem=function(n){if(console.log("addItem!"),angular.isArray(i.contentArray)){var r=angular.copy(o.modelFactory);n&&(r.title=n),r.onEdit=!0,i.contentArray.push(r),e(function(){t.$apply()},1)}}}var o=o||{},r=o.controller||"PageController",i={link:n,templateUrl:"views/partials/add-autocomplete.ng.html",restrict:"A",scope:{content:"=",contentArray:"="},controller:r,controllerAs:"vm",bindToController:!0};for(option in o)i[option]=o[option];return i};return{getInstance:t}}function CoreAdminDirectiveFactory(e){var t=function(t,o){function n(t,o,n,r){t.$watch("vm.itemUpdatedCounter",function(o){o>0&&Materialize.toast("Content Updated: "+r.content.title,2500,"rounded",function(){r.content.onEdit=!1,e(function(){t.$apply()},1)})},!0)}var o=o||{},r=o.controller||"PageController",i={link:n,templateUrl:"views/admin/partials/admin-directive.ng.html",restrict:"A",scope:{content:"=",contentCollection:"=",sortable:"=",index:"=",internalEdit:"@"},controller:r,controllerAs:"vm",bindToController:!0};for(option in o)i[option]=o[option];return i};return{getInstance:t}}function coreAutocompleteDirectiveFactory(e,t,o){var n=function(n,r){function i(n,i,a,c){function d(){h=!0,e(function(){h=!1},C)}function u(){console.log("vmreset",c.multipleSelect,c),c.multipleSelect||n.vm.autocompleteItemsArray&&(n.autocompleteCollectionSelected.removeAll(),n.vm.autocompleteItemsArray=[])}function s(e){e&&!h&&!g&&e.length>=y&&m(e),f()}function m(e){n.showAutocomplete=!0,n.loadingDelayActive||c.loading||!e||e.length<y||(console.log("start refresh"),r.url&&(c.loading=!0,o({method:"GET",url:r.url,cache:!0,params:{search:e}}).then(function(e){n.autocompleteCollection.removeAll(),n.autocompleteCollection.addAll(e.data),c.loading=!1},function(e){console.log("etrrror",e),c.loading=!1})),r.url||c.refresh({search:e,collection:n.autocompleteCollection,cache:!0}))}function f(t){var o=t||v;g=!0,e(function(){g=!1},o)}function p(){i.bind("mouseout",function(e){console.log("mouseout"),A?n.showAutocomplete=!0:n.showAutocomplete=!1,n.$apply(),i.unbind("mouseout")})}var g=!1,v=1e3,C=500,h=!1;f(),n.autocompleteCollection=t.getInstance(),n.autocompleteCollectionSelected=t.getInstance(),n.autocomplete=[];var y=n.vm.minimumChars||l,I=n.vm.defaultId||0,A=n.vm.multipleSelect||!1;n.$watch("vm.search",function(t){t&&(t=t.trim(),console.log("activate watch:",t),d(),e(function(){h||s(t)},C))},!0),n.vm.selectItem=function(e,t,o){if(p(),t){n.vm.autocompleteItem=n.vm.autocompleteItem||{},u();var r=angular.copy(n.vm.autocompleteItem.onEdit);f();var i=e.id;o&&e[o]&&(i=e[o]),n.vm.autocompleteItemId=i,n.vm.autocompleteItem=angular.copy(e),A?(n.showAutocomplete=!0,r=!0):n.showAutocomplete=!1,console.log("checked"),console.log(n.vm.autocompleteItemAttr),n.vm.autocompleteItemAttr&&(n.vm.autocompleteItemAttrModel=e[n.vm.autocompleteItemAttr]),n.vm.autocompleteItemsArray&&(n.vm.autocompleteItemsArray.push(e),console.log("scope.vm.autocompleteItem",n.vm.autocompleteItem),console.log("scope.vm.autocompleteItemsArray",n.vm.autocompleteItemsArray),n.vm.autocompleteItem.deleted=!0,r=!0),n.vm.autocompleteItem.onEdit=r,n.autocompleteCollectionSelected.add(e)}else n.vm.autocompleteItemId=I,n.vm.autocompleteItem={},n.autocompleteCollectionSelected.remove(e)},n.isChecked=function(e){var t=!1;return n.autocompleteCollectionSelected.get(e.id)&&(t=!0),t}}var l=2,r=r||{},a=r.controller||"PageController",c={link:i,templateUrl:"views/partials/autocomplete.ng.html",restrict:"A",scope:{search:"=",autocompleteItemId:"=?",autocompleteItem:"=",autocompleteItemAttr:"@",autocompleteItemAttrModel:"=",minimumChars:"@",autocompleteItemsArray:"=",defaultId:"@",multipleSelect:"=",autocompleteItems:"="},controller:a,controllerAs:"vm",bindToController:!0};for(option in r)c[option]=r[option];return c};return{getInstance:n}}function CoreCollectionFactory(){function e(e,t){return e instanceof Array&&e.splice(t,1),e}function t(e,t,o){if(o!==!1||confirm("Remove?"))if(t instanceof Array){var n=t.indexOf(e);t.splice(n,1)}else if("object"==typeof t)try{t.remove(e)}catch(r){console.info(r)}}var o={removeByIndex:e,unsetItem:t};return o}function CoreHelperFactory(){function e(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var t={guid:e};return t}function CoreLocaleFactory(){function e(e){isHebrew=!1;for(var t=0;t<e.length;t++){var o=e.charCodeAt(t);if(o>1424&&1535>o){console.log("charTest",o),isHebrew=!0;break}}return isHebrew}var t={isStrContainHebrew:e};return t}function csRestCtrlFactory(e){function t(e){var t={},e=e||{};if(e.queryParams)for(param in e.queryParams)t[param]=e.queryParams[param];return e.search&&(t.search=e.search),t}function o(e,t){return e instanceof Array&&e.splice(t,1),e}function n(e,t,o){if(o!==!1||confirm("Remove?")){if(t instanceof Array)for(var n=0;n<t.length;n++)e.id==t[n].id&&t.splice(n,1);if("object"==typeof t)try{t.remove(e)}catch(r){console.info(r)}}}var r=function(r,i){function l(e){return e||(e=r.defaultKey),e}r.counterPost=0,r.responseError=!1,r.itemUpdatedCounter=0,r.activeItems={},r.activeItemId=0,r.defaultKey="defaultKey",r.currentFullResponse={},r.editOrgItem={},i.collection&&(r.contents=i.collection),r.loading=!1,r.createCallback=i.createCallback||function(){},i.decorate_ext?r.decorate_ext=i.decorate_ext:r.decorate_ext=!1,i.decorateMutator_ext?r.decorateMutator_ext=i.decorateMutator_ext:r.decorateMutator_ext=!1;var a=t;r.refresh=function(t){r.currentFullResponse={};var t=t||{},o=a(t),n="get";t.cahce&&(n="getCache"),r.loading=!0,i.rs[n](o).$promise.then(function(e){r.currentFullResponse=e,e=e.data;var o=i.decorateOutputArray(e);csd1.log("success",e),t.collection?(t.collection.removeAll(),t.collection.addAll(o)):i.collection&&(r.contents.removeAll(),r.contents.addAll(o)),r.loading=!1},function(t){e.$broadcast("serverError",{error:t}),console.log("error",t),r.loading=!1})},r.addNew=function(){r.newItem=new i.getModel,r.editItem(r.newItem)},r.addContent=function(e,t){return i.addContent(e,t)},r.save=function(e){i.decorateMutator&&(e=i.decorateMutator(e)),e.id?d(e):c(e)},r.remove=function(e,t){if(confirm("Remove?")){if(!e.id)return void i.collection.remove(e);r.loading=!0,i.rs["delete"]({id:e.id}).$promise.then(function(o){if(console.log("success",o),t){if(t instanceof Array)for(var n=0;n<t.length;n++)console.log(e,t[n]),e.id&&e.id==t[n].id&&t.splice(n,1)}else i.collection.remove(e);r.loading=!1},function(e){console.log("error",e),r.loading=!1})}},r.unsetItem=n,r.removeByIndex=o;var c=function(e){if(!r.loading){var t=angular.copy(e);r.loading=!0,r.counterPost+=1,i.create(t).then(function(t){r.loading=!1,r.itemUpdatedCounter+=1,e.onEdit=!1,r.createCallback&&r.createCallback(t)},function(e,t){r.responseError="",console.log("error",e,t),r.loading=!1,r.responseError="oops...."})}},d=function(t){if(!r.loading){var o=angular.copy(t);r.loading=!0,i.rs.update(t).$promise.then(function(n){r.loading=!1;var l=i.decorateOutputItem(n.data);t=l,r.contents&&l.id&&(r.contents.get(l.id)?r.contents.update(l):r.contents.add(l)),t.onEdit=!1,r.resetActiveItem(),r.itemUpdatedCounter+=1,o.id||(t=!1),e.$broadcast("serverSuccess",{response:n})},function(t){console.log("error11",t),e.$broadcast("serverError",{error:t}),r.serverError=t,r.loading=!1})}};return r.cancelSave=function(e){e.onEdit=!1,r.resetActiveItem(),r.editOrgItem&&angular.copy(r.editOrgItem,e),e.onEdit=!1},r.resetActiveItem=function(){r.setActiveItem({},null,!1),r.activeItemId=0},r.resetEditOrg=function(){r.editOrgItem={}},r.editItem=function(e){e.onEdit=!0,angular.copy(e,r.editOrgItem),e.opened_for_edit=!0,r.setActiveItem(e)},r.endEditItem=function(e){e.onEdit=!1,r.resetActiveItem()},r.setActiveItem=function(e,t,o){return t=l(t),e=e||{},this.isActiveItem(e,t)&&!o||o===!1?this.activeItems[t]={}:this.activeItems[t]=e,r.activeItemId=e.id||!0,this.getActiveItem(t)},r.isActiveItem=function(e,t){t=l(t);var o=!1;return this.activeItems[t]&&(o=e.id==this.activeItems[t].id),o},r.getActiveItem=function(e){e=l(e);var t;return t=angular.isDefined(this.activeItems[e])?this.activeItems[e]:this.setActiveItem(e)},r.getActiveItemId=function(e){var t=r.getActiveItem(e),o=!1;return t&&(o=t.id),o},r};return{getInstance:r}}function CoreRestFactory(e,t,o,n,r,i){function l(e){var o=t(e+"/:id?",{id:"@id"},{update:{method:"PUT"},queryCache:{method:"GET",isArray:!0,cache:!0}});return o}function a(){return e.getInstance()}var c=function(e){var t={};t.config=e.config||{},t.baseUrl=e.baseUrl,t.url=e.baseUrl,t.addContentSettings=e.addContentSettings,t.model=e.model||{},t.autoEditOnAdd=e.autoEditOnAdd||!0,t.rs=l(t.baseUrl),t.collection=a();var r=e.decorateOutputSettings||{};return t.decorate_ext=e.decorate_ext||!1,t.decorateMutator_ext=e.decorateMutator_ext||!1,t.getModel=function(){return angular.copy(t.model)},t.create=function(e){var r=n.defer();return o.post(this.url,e).success(function(e){r.resolve(e),angular.isDefined(t.collection)&&t.collection.add(e.data)}).error(function(e){r.reject(e)}),r.promise},t.addContent=function(e,o){if(console.log("addContent",e,o),t.addContentSettings&&t.addContentSettings[o]){e[o]=e[o]||[];var n=t.addContentSettings[o].model||[];t.autoEditOnAdd&&(n.onEdit=!0),e[o].push(angular.copy(n))}},t.decorateOutputArray=function(e){var o=[];if(angular.isArray(e))for(var n=0;n<e.length;n++){var r=t.decorateOutputItem(e[n]);r.nameRandom=i.guid(),r.indexOrder=n,o.push(r)}return o},t.decorateOutputItem=function(e){return r.trustFieldsHtml,t.decorate_ext&&(e=t.decorate_ext(e)),e},t.escapeTrustHtmlFields=function(e,t){for(var o=0;t.length;o++){fieldsArray=t.split(".");for(;field;);}},t.decorateMutatorArray=function(e){if(!t.decorateMutator)return e;for(var o=[],n=0;n<e.length;n++){var r=t.decorateMutator(e[n]);o.push(r)}return o},t.decorateMutator=function(e){return t.decorateMutator_ext&&(e=t.decorateMutator_ext(e)),e},t};return{getCollection:a,getResource:l,getInstance:c}}function CoreFormController(){var e=this;e.name="CoreFormController"}function coreFormInput(e){function t(e,t,o,n){e.inputType=n.inputType,"checkbox"==e.inputType&&(n.checked?(e.checked=!0,n.fieldModel=!0):n.fieldModel=!1);var r="";n.fieldTitle&&(r=n.fieldTitle.replace(/ /g,"")),e.inputId="input_"+n.fieldTitle+"_"+Math.random()}var o={link:t,templateUrl:"views/angularCoreRest/formInputElement.ng.html",restrict:"A",scope:{fieldModel:"=",fieldTitle:"@",fieldName:"@",inputType:"@",checked:"="},controller:"CoreFormController",controllerAs:"vm",bindToController:!0};return o}function coreFormQuill(e){function t(e,t,o,n){e.editActive=!1,e.fieldModel=n.fieldModel,e.$on("textChanged",function(e,t){console.log("textChanged",t[0]),n.fieldModel=t[0],e.preventDefault()}),e.$on("editActive",function(t,o){console.log("editActive",o[0]),e.editActive=o[0],t.preventDefault()}),e.$watch("vm.fieldModel",function(){console.log("updateText - vm.fieldModel !!",n.fieldModel)}),console.log("scope.fieldModel",e.fieldModel),e.inputType=n.inputType,e.inputId="input_"+n.fieldModel+"_"+Math.random(),e.editorName="editor_"+n.fieldModel+"_"+Math.random()}var o={link:t,templateUrl:"views/angularCoreRest/formQuillElement.ng.html",restrict:"A",scope:{fieldModel:"=",fieldTitle:"@",inputType:"@"},controller:"CoreFormController",controllerAs:"vm",bindToController:!0};return o}function CoreListController(e){var t=this;t.name="gulp watch",t.remove=function(o){console.log(t.name,t),e.unsetItem(o,t.collectionArray)}}angular.module("ngCoreRest",[]),angular.module("ngCoreRest").controller("CoreCkeditorController",CoreCkeditorController),CoreCkeditorController.$inject=[],angular.module("ngCoreRest").directive("contentEditable",contentEditable),contentEditable.$inject=[],angular.module("ngCoreRest").directive("coreCkeditor",coreCkeditor),coreCkeditor.$inject=["$timeout","MainStatusFactory"],angular.module("ngCoreRest").directive("coreKeepRatio",coreKeepRatio),coreKeepRatio.$inject=["$timeout"],angular.module("ngCoreRest").factory("CoreAddAutocompleteDirectiveFactory",coreAddAutocompleteDirectiveFactory),coreAddAutocompleteDirectiveFactory.$inject=["$timeout"],angular.module("ngCoreRest").factory("CoreAdminDirectiveFactory",CoreAdminDirectiveFactory),CoreAdminDirectiveFactory.$inject=["$timeout"],angular.module("ngCoreRest").factory("CoreAutocompleteDirectiveFactory",coreAutocompleteDirectiveFactory),coreAutocompleteDirectiveFactory.$inject=["$timeout","$collection","$http"],angular.module("ngCoreRest").factory("CoreCollectionFactory",CoreCollectionFactory),CoreCollectionFactory.$inject=[],angular.module("ngCoreRest").factory("CoreHelperFactory",CoreHelperFactory),CoreHelperFactory.$inject=[],angular.module("ngCoreRest").factory("CoreLocaleFactory",CoreLocaleFactory),CoreLocaleFactory.$inject=[],angular.module("ngCoreRest").factory("CoreRestCtrlFactory",csRestCtrlFactory),csRestCtrlFactory.$inject=["$rootScope"],angular.module("ngCoreRest").factory("CoreRestFactory",CoreRestFactory),CoreRestFactory.$inject=["$collection","$resource","$http","$q","$sce","CoreHelperFactory"],angular.module("ngCoreRest").filter("showOnlyOnEdit",function(){return function(e){for(var t=[],o=0;o<e.length;o++){var n=e[o];n.onEdit&&t.push(n)}return t=t.length?t:e}}),angular.module("ngCoreRest").controller("CoreFormController",CoreFormController),CoreFormController.$inject=[],angular.module("ngCoreRest").directive("coreFormInput",coreFormInput),coreFormInput.$inject=["$timeout"],angular.module("ngCoreRest").directive("coreFormQuill",coreFormQuill),coreFormQuill.$inject=["$timeout"],angular.module("ngCoreRest").controller("CoreListController",CoreListController),CoreListController.$inject=["CoreCollectionFactory"],angular.module("ngCoreRest").run(["$templateCache",function(e){e.put("views/angularCoreRest/coreCkeditor.ng.html",'<p>\n    <div ng-show="editActive">\n        <textarea cols="80" id="[[editorName]]" name="[[editorName]]" ng-model="vm.ngModel" rows="10" ></textarea>\n    </div>\n\n\n\n    <div class="editQuill" ng-show="!editActive" ng-click="init()">\n        <div ng-bind-html="vm.ngModel"></div>\n        <i class="material-icons">mode_edit</i>\n    </div>\n</p>\n'),e.put("views/angularCoreRest/formInputElement.ng.html",'<div class="input-field" ng-switch="inputType">\n\n\n    <span ng-switch-when="datepicker">\n        <input type="date" id="[[vm.content.nameRandom]]" class="datepicker" ncm-datepicker bind-to-model="vm.fieldModel">\n        <label for="[[vm.content.nameRandom]]" class="active">[[vm.fieldTitle]]</label>\n    </span>\n\n    <span ng-switch-when="textareaQuill">\n        <div ng-quill-editor text-model="vm.fieldModel" on-edit="vm.content.onEdit"></div>\n    </span>\n\n    <span ng-switch-when="textarea">\n        <textarea id="[[inputId]]"  ng-model="vm.fieldModel" class="materialize-textarea"></textarea>\n        <label for="[[inputId]]" ng-class="{active:vm.fieldModel}">[[vm.fieldTitle]]</label>\n    </span>\n\n    <span ng-switch-when="checkbox">\n        <input type="checkbox" id="[[inputId]]"  ng-model="vm.fieldModel" class="filled-in" value="true" ng-checked="checked"/>\n        <label for="[[inputId]]" >[[vm.fieldTitle]]</label>\n    </span>\n    <span ng-switch-default>\n        <input id="[[inputId]]" type="text" ng-model="vm.fieldModel" class="validate" name="vm.fieldName">\n        <label for="[[inputId]]" ng-class="{active:vm.fieldModel}">[[vm.fieldTitle]]</label>\n    </span>\n\n\n</div>\n\n\n\n'),e.put("views/angularCoreRest/formQuillElement.ng.html",'\n\n<div class="ngQuillWrapper">\n    <div ng-show="editActive">\n        <ng-quill-editor name="editorName" callback="editorCallback(editor, name)" ng-model="fieldModel" text="fieldModel" translations="translations"\n                         toolbar="true" show-toolbar="true" link-tooltip="true" image-tooltip="false"\n                         toolbar-entries="font size bold list bullet italic underline strike align color background link"\n                         editor-required="true" required="" error-class="input-error"\n                         fontsize-options="fontsizeOptions" fontfamily-options="fontfamilyOptions">\n\n        </ng-quill-editor>\n    </div>\n\n\n    <div class="editQuill" ng-show="!editActive">\n        <div ng-bind-html="fieldModel"></div>\n        <i class="material-icons">mode_edit</i>\n    </div>\n</div>\n\n\n\n')}]);